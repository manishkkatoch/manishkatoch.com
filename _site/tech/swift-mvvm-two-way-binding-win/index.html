<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Swift + MVVM + Two Way Binding = Win!</title>
    <meta name="description" content="A way to achieve two way bindings on a UIControl and Observable, so that you write the code, you want to write, not the code you have to write">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/prism.base16.monokai.dark.css">
    
      <link rel="stylesheet" href="/css/home.css">
    
      <link rel="stylesheet" href="/css/footer.css">
    
      <link rel="stylesheet" href="/css/post.css">
    
    <link rel="alternate" href="." type="application/atom+xml" title="">
    <link rel="alternate" href="." type="application/json" title="">
    <script src="https://kit.fontawesome.com/0a5d5a6a83.js" crossorigin="anonymous"></script>
  </head>
  <body>
  <section class="container-fluid align-items-center">
       <div class="row dark-bg">
         <nav class="navbar navbar-expand-lg">
    <span class="navbar-brand">
        <img class="hero" src="/images/about_me.jpg" />
    </span>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
      <ul class="navbar-nav">
      
        <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="/tech/">Tech</a></li>
      </ul>
    </div>
  </nav>
      </div>
      <div class="row main-row">
      <div class="col-lg-12">
       
<section class="container-fluid align-items-center post" >
  <img src="https://source.unsplash.com/ImcUkZ72oUs/1600x900" class="banner"/>
  <div class="credit">
    <a target="_blank" href="https://unsplash.com/@othentikisra">israel palacio</a> on 
    <a target="_blank" href="https://unsplash.com">Unsplash </a>
  </div>
  <h1>Swift + MVVM + Two Way Binding = Win!
  </h1>

  <div class="meta">
  <p class="date">Nov 26, 2017</p>
    
        <a href="/tags/tech/" class="post-tag">#tech</a>
        <a href="/tags/mobile/" class="post-tag">#mobile</a>
        <a href="/tags/ios/" class="post-tag">#ios</a>
        <a href="/tags/swift/" class="post-tag">#swift</a>
    
  </div>
  <p>
    <p>MVVM? why not MVC that Apple recommends? Android does MVP great right? How about the cool VIPER pattern? I believe great efforts have already been put to explain what each pattern brings to the table and so the idea here is not to add to the debate but merely build on top of the opinion I have already formed: <em>MVVM is the way to go</em>.</p>
<p>As a quick primer to what MVVM is, it is a design pattern whereby the ViewModel mediates between a data providing Model and View which displays the data provided. Kind of like the following diagram:</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/b/b5/ModelViewControllerDiagram2.svg" alt="model-view-controller"></p>
<p>in iOS, View is essentially a ViewController and ViewModel is an object (a structure) which provides exact data for the view to render.</p>
<p>This provides a loosely coupled architecture which is maintainable ( very thin view controllers ) and testable (ViewModel abstracts out the UI and hence is easily testable).</p>
<p>There is still a caveat though: classic MVVM allows for single responsibility principle easily (and beautifully) in case of models as domain models. However, in case of anaemic models ( which is generally the case when you have well written REST APIs), one would also need another <em>Mediator</em> or <em>Presenter</em> which facilitates data and navigation flow.</p>
<p>Now, View Model has responsibility to update View as well as get updates from View regarding the changes made by the user. This can be achieved by minimum code using bi-directional data binding.</p>
<p>But …</p>
<p>I was bit stumped here, with KVO bindings as first class feature from time unknown, I was expecting two way bindings to be available organically too. the alternatives are available though, thankfully, like <em>SwiftBond</em>, or full fledged reactive libraries like <em>RxSwift</em>, <em>RxCocoa</em>.</p>
<p>Since two binding is a very tiny spec in paradigm of Reactive Programming, unless I am working with streams, I believe its a <em>heavy</em> dependency to have in the application and instead, explored what it takes to have two way bindings working cleanly and quickly.</p>
<h4 id="the-observable">The Observable <a class="direct-link" href="#the-observable">#</a></h4>
<p>Two way binding is essentially a Observer-Listener (or Pub/Sub) pattern in a bi-directional setup. The two participants, generally a Control and a DataProvider are bound to each other such that on change of values, the corresponding component’s listener is notified with value changed.</p>
<p>Firstly, we need the Observable to provide the above pattern.Consider following gist:</p>
<pre class="language-swift"><code class="language-swift"><span class="token comment">//</span><br><span class="token comment">//  Observable.swift</span><br><span class="token comment">//  SimpleTwoWayBinding</span><br><span class="token comment">//</span><br><span class="token comment">//  Created by Manish Katoch on 11/26/17.</span><br><span class="token comment">//</span><br><span class="token keyword">import</span> <span class="token builtin">Foundation</span><br><br><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Observable</span><span class="token operator">&lt;</span><span class="token builtin">ObservedType</span><span class="token operator">></span> <span class="token punctuation">{</span><br>    <span class="token keyword">public</span> <span class="token keyword">typealias</span> <span class="token builtin">Observer</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">_</span> observable<span class="token punctuation">:</span> <span class="token builtin">Observable</span><span class="token operator">&lt;</span><span class="token builtin">ObservedType</span><span class="token operator">></span><span class="token punctuation">,</span> <span class="token builtin">ObservedType</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">Void</span><br>    <br>    <span class="token keyword">private</span> <span class="token keyword">var</span> observers<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token builtin">Observer</span><span class="token punctuation">]</span><br>    <br>    <span class="token keyword">public</span> <span class="token keyword">var</span> value<span class="token punctuation">:</span> <span class="token builtin">ObservedType</span><span class="token operator">?</span> <span class="token punctuation">{</span><br>        <span class="token keyword">didSet</span> <span class="token punctuation">{</span><br>            <span class="token keyword">if</span> <span class="token keyword">let</span> value <span class="token operator">=</span> value <span class="token punctuation">{</span><br>                <span class="token function">notifyObservers</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><br>            <span class="token punctuation">}</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>    <br>    <span class="token keyword">public</span> <span class="token keyword">init</span><span class="token punctuation">(</span><span class="token number">_</span> value<span class="token punctuation">:</span> <span class="token builtin">ObservedType</span><span class="token operator">?</span> <span class="token operator">=</span> <span class="token constant">nil</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<br>        observers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><br>    <br>    <span class="token keyword">public</span> <span class="token keyword">func</span> <span class="token function">bind</span><span class="token punctuation">(</span>observer<span class="token punctuation">:</span> @escaping <span class="token builtin">Observer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>observers<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>    <br>    <span class="token keyword">private</span> <span class="token keyword">func</span> <span class="token function">notifyObservers</span><span class="token punctuation">(</span><span class="token number">_</span> value<span class="token punctuation">:</span> <span class="token builtin">ObservedType</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>observers<span class="token punctuation">.</span>forEach <span class="token punctuation">{</span> <span class="token punctuation">[</span><span class="token keyword">unowned</span> <span class="token keyword">self</span><span class="token punctuation">]</span><span class="token punctuation">(</span>observer<span class="token punctuation">)</span> <span class="token keyword">in</span><br>            <span class="token function">observer</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>A simple generic class Observable which notifies all the “observers” whenever its value is set. note: <em>The nullability is more to signify unset condition than actual null value to the observed data.</em></p>
<h4 id="bindable">Bindable <a class="direct-link" href="#bindable">#</a></h4>
<p>Now that we have Observable, we can define a protocol which can be conformed by UI Controls (or any object essentially, or you can create your custom controls ) which will allow you to have the bi directional setup.</p>
<pre class="language-swift"><code class="language-swift"><span class="token comment">//</span><br><span class="token comment">//  Bindable.swift</span><br><span class="token comment">//  SimpleTwoWayBinding</span><br><span class="token comment">//</span><br><span class="token comment">//  Created by Manish Katoch on 11/26/17.</span><br><span class="token comment">//</span><br><span class="token keyword">import</span> <span class="token builtin">Foundation</span><br><span class="token keyword">import</span> <span class="token builtin">UIKit</span><br><br><span class="token keyword">public</span> <span class="token keyword">protocol</span> <span class="token builtin">Bindable</span><span class="token punctuation">:</span> <span class="token builtin">NSObjectProtocol</span> <span class="token punctuation">{</span><br>    associatedtype <span class="token builtin">BindingType</span><span class="token punctuation">:</span> <span class="token builtin">Equatable</span><br>    <span class="token keyword">func</span> <span class="token function">observingValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">BindingType</span><span class="token operator">?</span><br>    <span class="token keyword">func</span> <span class="token function">updateValue</span><span class="token punctuation">(</span>with value<span class="token punctuation">:</span> <span class="token builtin">BindingType</span><span class="token punctuation">)</span><br>    <span class="token keyword">func</span> <span class="token function">bind</span><span class="token punctuation">(</span>with observable<span class="token punctuation">:</span> <span class="token builtin">Observable</span><span class="token operator">&lt;</span><span class="token builtin">BindingType</span><span class="token operator">></span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br>fileprivate <span class="token keyword">struct</span> <span class="token builtin">AssociatedKeys</span> <span class="token punctuation">{</span><br>    <span class="token keyword">static</span> <span class="token keyword">var</span> binder<span class="token punctuation">:</span> <span class="token builtin">UInt8</span> <span class="token operator">=</span> <span class="token number">0</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">extension</span> <span class="token builtin">Bindable</span> <span class="token keyword">where</span> <span class="token keyword">Self</span><span class="token punctuation">:</span> <span class="token builtin">NSObject</span> <span class="token punctuation">{</span><br><br>    <span class="token keyword">private</span> <span class="token keyword">var</span> binder<span class="token punctuation">:</span> <span class="token builtin">Observable</span><span class="token operator">&lt;</span><span class="token builtin">BindingType</span><span class="token operator">></span> <span class="token punctuation">{</span><br>        <span class="token keyword">get</span> <span class="token punctuation">{</span><br>            <span class="token keyword">guard</span> <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token function">objc_getAssociatedObject</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token builtin">AssociatedKeys</span><span class="token punctuation">.</span>binder<span class="token punctuation">)</span> <span class="token keyword">as</span><span class="token operator">?</span> <span class="token builtin">Observable</span><span class="token operator">&lt;</span><span class="token builtin">BindingType</span><span class="token operator">></span> <span class="token keyword">else</span> <span class="token punctuation">{</span><br>                <span class="token keyword">let</span> newValue <span class="token operator">=</span> <span class="token builtin">Observable</span><span class="token operator">&lt;</span><span class="token builtin">BindingType</span><span class="token operator">></span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>                <span class="token function">objc_setAssociatedObject</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token builtin">AssociatedKeys</span><span class="token punctuation">.</span>binder<span class="token punctuation">,</span> newValue<span class="token punctuation">,</span> objc_AssociationPolicy<span class="token punctuation">.</span><span class="token constant">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span><span class="token punctuation">)</span><br>                <span class="token keyword">return</span> newValue<br>            <span class="token punctuation">}</span><br>            <span class="token keyword">return</span> value<br>        <span class="token punctuation">}</span><br>        <span class="token keyword">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>             <span class="token function">objc_setAssociatedObject</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span><span class="token builtin">AssociatedKeys</span><span class="token punctuation">.</span>binder<span class="token punctuation">,</span> newValue<span class="token punctuation">,</span> objc_AssociationPolicy<span class="token punctuation">.</span><span class="token constant">OBJC_ASSOCIATION_RETAIN_NONATOMIC</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>    <br>    <span class="token keyword">func</span> <span class="token function">getBinderValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">BindingType</span><span class="token operator">?</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> binder<span class="token punctuation">.</span>value<br>    <span class="token punctuation">}</span><br>    <br>    <span class="token keyword">func</span> <span class="token function">setBinderValue</span><span class="token punctuation">(</span>with value<span class="token punctuation">:</span> <span class="token builtin">BindingType</span><span class="token operator">?</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        binder<span class="token punctuation">.</span>value <span class="token operator">=</span> value<br>    <span class="token punctuation">}</span><br>    <br>    <span class="token keyword">func</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token keyword">for</span> observable<span class="token punctuation">:</span> <span class="token builtin">Observable</span><span class="token operator">&lt;</span><span class="token builtin">BindingType</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        binder <span class="token operator">=</span> observable<br>    <span class="token punctuation">}</span><br>    <br>    <span class="token keyword">func</span> <span class="token function">valueChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> binder<span class="token punctuation">.</span>value <span class="token operator">!=</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">observingValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token function">setBinderValue</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">observingValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">public</span> <span class="token keyword">func</span> <span class="token function">bind</span><span class="token punctuation">(</span>with observable<span class="token punctuation">:</span> <span class="token builtin">Observable</span><span class="token operator">&lt;</span><span class="token builtin">BindingType</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token keyword">let</span> _self <span class="token operator">=</span> <span class="token keyword">self</span> <span class="token keyword">as</span><span class="token operator">?</span> <span class="token builtin">UIControl</span> <span class="token punctuation">{</span><br>            _self<span class="token punctuation">.</span><span class="token function">addTarget</span><span class="token punctuation">(</span><span class="token builtin">Selector</span><span class="token punctuation">,</span> action<span class="token punctuation">:</span> <span class="token builtin">Selector</span><span class="token punctuation">{</span> <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">valueChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">for</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">.</span>editingChanged<span class="token punctuation">,</span> <span class="token punctuation">.</span>valueChanged<span class="token punctuation">]</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>binder <span class="token operator">=</span> observable<br>        <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> observable<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token keyword">in</span><br>            <span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">updateValue</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> value<span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>        <br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>In the above gist, you have a Bindable protocol which has default implementation which uses an internal binder Observable object (objc associatedobjects FTW! ) which is set on control state change detected.(shout out to <a href="https://github.com/cprovatas">https://github.com/cprovatas</a> for Selector based action approach. very nifty!)</p>
<h4 id="uicontrols-%2B-bindable">UIControls + Bindable <a class="direct-link" href="#uicontrols-%2B-bindable">#</a></h4>
<p>Now that you have Bindable and Observable in place, lets have common control’s extension and get them ready for action:</p>
<pre class="language-swift"><code class="language-swift"><br><span class="token comment">//</span><br><span class="token comment">//  UIControls+Bindable.swift</span><br><span class="token comment">//  SimpleTwoWayBinding</span><br><span class="token comment">//</span><br><span class="token comment">//  Created by Manish Katoch on 11/26/17.</span><br><span class="token comment">//</span><br><span class="token keyword">import</span> <span class="token builtin">Foundation</span><br><br><span class="token keyword">extension</span> <span class="token builtin">UITextField</span> <span class="token punctuation">:</span> <span class="token builtin">Bindable</span> <span class="token punctuation">{</span><br>    <span class="token keyword">public</span> <span class="token keyword">typealias</span> <span class="token builtin">BindingType</span> <span class="token operator">=</span> <span class="token builtin">String</span><br>    <br>    <span class="token keyword">public</span> <span class="token keyword">func</span> <span class="token function">observingValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">String</span><span class="token operator">?</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span>text<br>    <span class="token punctuation">}</span><br>    <br>    <span class="token keyword">public</span> <span class="token keyword">func</span> <span class="token function">updateValue</span><span class="token punctuation">(</span>with value<span class="token punctuation">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>text <span class="token operator">=</span> value<br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">extension</span> <span class="token builtin">UISwitch</span> <span class="token punctuation">:</span> <span class="token builtin">Bindable</span> <span class="token punctuation">{</span><br>    <span class="token keyword">public</span> <span class="token keyword">typealias</span> <span class="token builtin">BindingType</span> <span class="token operator">=</span> <span class="token builtin">Bool</span><br>    <br>    <span class="token keyword">public</span> <span class="token keyword">func</span> <span class="token function">observingValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">Bool</span><span class="token operator">?</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span>isOn<br>    <span class="token punctuation">}</span><br>    <br>    <span class="token keyword">public</span> <span class="token keyword">func</span> <span class="token function">updateValue</span><span class="token punctuation">(</span>with value<span class="token punctuation">:</span> <span class="token builtin">Bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>isOn <span class="token operator">=</span> value<br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">extension</span> <span class="token builtin">UISlider</span> <span class="token punctuation">:</span> <span class="token builtin">Bindable</span> <span class="token punctuation">{</span><br>    <span class="token keyword">public</span> <span class="token keyword">typealias</span> <span class="token builtin">BindingType</span> <span class="token operator">=</span> <span class="token builtin">Float</span><br>    <br>    <span class="token keyword">public</span> <span class="token keyword">func</span> <span class="token function">observingValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">Float</span><span class="token operator">?</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span>value<br>    <span class="token punctuation">}</span><br>    <br>    <span class="token keyword">public</span> <span class="token keyword">func</span> <span class="token function">updateValue</span><span class="token punctuation">(</span>with value<span class="token punctuation">:</span> <span class="token builtin">Float</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">extension</span> <span class="token builtin">UIStepper</span> <span class="token punctuation">:</span> <span class="token builtin">Bindable</span> <span class="token punctuation">{</span><br>    <span class="token keyword">public</span> <span class="token keyword">typealias</span> <span class="token builtin">BindingType</span> <span class="token operator">=</span> <span class="token builtin">Double</span><br>    <br>    <span class="token keyword">public</span> <span class="token keyword">func</span> <span class="token function">observingValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">Double</span><span class="token operator">?</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> <span class="token keyword">self</span><span class="token punctuation">.</span>value<br>    <span class="token punctuation">}</span><br>    <br>    <span class="token keyword">public</span> <span class="token keyword">func</span> <span class="token function">updateValue</span><span class="token punctuation">(</span>with value<span class="token punctuation">:</span> <span class="token builtin">Double</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br></code></pre>
<p>Since we have already defined a default implementation: All we need to conform now to is the way each control updates and exposes its values using updateValue and observingValue methods. Pretty Simple!</p>
<h4 id="a-sample">A Sample <a class="direct-link" href="#a-sample">#</a></h4>
<p>Let’s put our mini framework to use. Let’s assume we are making a form. Firstly, we design a ViewModel which encapsulates our needs. All the properties that we need to monitor are wrapped with Observables. Like below (ignore few pretty get functions, they are BAU methods :) )</p>
<pre class="language-swift"><code class="language-swift"><span class="token comment">//</span><br><span class="token comment">//  FormViewModel.swift</span><br><span class="token comment">//  SimpleTwoWayBinding_Example</span><br><span class="token comment">//</span><br><span class="token comment">//  Created by Manish Katoch on 11/26/17.</span><br><span class="token comment">//  Copyright © 2017 CocoaPods. All rights reserved.</span><br><span class="token comment">//</span><br><span class="token keyword">import</span> <span class="token builtin">Foundation</span><br><span class="token keyword">import</span> <span class="token builtin">SimpleTwoWayBinding</span><br><br><span class="token keyword">struct</span> <span class="token builtin">FormViewModel</span> <span class="token punctuation">{</span><br>    <span class="token keyword">let</span> name<span class="token punctuation">:</span> <span class="token builtin">Observable</span><span class="token operator">&lt;</span><span class="token builtin">String</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token function">Observable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token keyword">let</span> companyName<span class="token punctuation">:</span> <span class="token builtin">Observable</span><span class="token operator">&lt;</span><span class="token builtin">String</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token function">Observable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token keyword">let</span> yearsOfExperience<span class="token punctuation">:</span> <span class="token builtin">Observable</span><span class="token operator">&lt;</span><span class="token builtin">Double</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token function">Observable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token keyword">let</span> isCurrentEmployer<span class="token punctuation">:</span> <span class="token builtin">Observable</span><span class="token operator">&lt;</span><span class="token builtin">Bool</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token function">Observable</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><br>    <span class="token keyword">let</span> approxSalary<span class="token punctuation">:</span> <span class="token builtin">Observable</span><span class="token operator">&lt;</span><span class="token builtin">Float</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token function">Observable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token keyword">let</span> comments<span class="token punctuation">:</span> <span class="token builtin">Observable</span><span class="token operator">&lt;</span><span class="token builtin">String</span><span class="token operator">></span> <span class="token operator">=</span> <span class="token function">Observable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <br>    <span class="token keyword">func</span> <span class="token function">getExperienceString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">String</span> <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token keyword">let</span> yearsOfExperience <span class="token operator">=</span> yearsOfExperience<span class="token punctuation">.</span>value <span class="token punctuation">{</span><br>            <span class="token keyword">return</span> <span class="token string">"<span class="token interpolation"><span class="token delimiter variable">\(</span><span class="token function">String</span><span class="token punctuation">(</span>describing<span class="token punctuation">:</span> yearsOfExperience<span class="token punctuation">)</span><span class="token delimiter variable">)</span></span> yrs"</span><br>        <span class="token punctuation">}</span><br>        <span class="token keyword">return</span> <span class="token string">"--"</span><br>    <span class="token punctuation">}</span><br>    <br>    <span class="token keyword">func</span> <span class="token function">getSalaryString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">String</span> <span class="token punctuation">{</span><br>        <span class="token keyword">if</span> <span class="token keyword">let</span> approxSalary <span class="token operator">=</span> approxSalary<span class="token punctuation">.</span>value <span class="token punctuation">{</span><br>            <span class="token keyword">let</span> normalizedValue <span class="token operator">=</span> approxSalary <span class="token operator">/</span> <span class="token number">1000.0</span><br>            <span class="token keyword">return</span> <span class="token string">"<span class="token interpolation"><span class="token delimiter variable">\(</span>normalizedValue<span class="token delimiter variable">)</span></span>k"</span><br>            <br>        <span class="token punctuation">}</span><br>        <span class="token keyword">return</span> <span class="token string">"--"</span><br>    <span class="token punctuation">}</span><br>    <br>    <span class="token keyword">func</span> <span class="token function">getPrettyString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token builtin">String</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span><br>            <span class="token string">"Name: <span class="token interpolation"><span class="token delimiter variable">\(</span><span class="token function">String</span><span class="token punctuation">(</span>describing<span class="token punctuation">:</span> name<span class="token punctuation">.</span>value <span class="token operator">?</span><span class="token operator">?</span> <span class="token string">"--"</span><span class="token punctuation">)</span><span class="token delimiter variable">)</span></span>\n"</span> <span class="token operator">+</span><br>            <span class="token string">"Company: <span class="token interpolation"><span class="token delimiter variable">\(</span><span class="token function">String</span><span class="token punctuation">(</span>describing<span class="token punctuation">:</span> companyName<span class="token punctuation">.</span>value <span class="token operator">?</span><span class="token operator">?</span> <span class="token string">"--"</span><span class="token punctuation">)</span><span class="token delimiter variable">)</span></span>\n"</span> <span class="token operator">+</span><br>            <span class="token string">"Experience: \(getExperienceString())\n"</span> <span class="token operator">+</span><br>            <span class="token string">"Current Employer?: <span class="token interpolation"><span class="token delimiter variable">\(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>isCurrentEmployer<span class="token punctuation">.</span>value <span class="token operator">?</span><span class="token operator">?</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">"YES"</span> <span class="token punctuation">:</span> <span class="token string">"NO"</span><span class="token delimiter variable">)</span></span>)\n"</span> <span class="token operator">+</span><br>            <span class="token string">"approx Salary: \(getSalaryString())\n"</span> <span class="token operator">+</span><br>            <span class="token string">"Comments: <span class="token interpolation"><span class="token delimiter variable">\(</span><span class="token function">String</span><span class="token punctuation">(</span>describing<span class="token punctuation">:</span> comments<span class="token punctuation">.</span>value <span class="token operator">?</span><span class="token operator">?</span> <span class="token string">"--"</span><span class="token punctuation">)</span><span class="token delimiter variable">)</span></span>"</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br></code></pre>
<p>With View Model in place, we go ahead and create our view controller. Now below is <em>all the code that you need to have your form working</em> :</p>
<pre class="language-swift"><code class="language-swift"><span class="token comment">//</span><br><span class="token comment">//  ViewController.swift</span><br><span class="token comment">//  SimpleTwoWayBinding</span><br><span class="token comment">//</span><br><span class="token comment">//  Created by Manish Katoch on 11/26/2017.</span><br><span class="token comment">//  Copyright (c) 2017 Manish Katoch. All rights reserved.</span><br><span class="token comment">//</span><br><span class="token keyword">import</span> <span class="token builtin">UIKit</span><br><span class="token keyword">import</span> <span class="token builtin">SimpleTwoWayBinding</span><br><br><span class="token keyword">class</span> <span class="token class-name">ViewController</span><span class="token punctuation">:</span> <span class="token builtin">UIViewController</span> <span class="token punctuation">{</span><br><br>    <span class="token atrule">@IBOutlet</span> <span class="token keyword">weak</span> <span class="token keyword">var</span> nameField<span class="token punctuation">:</span> <span class="token builtin">UITextField</span><span class="token operator">!</span><br>    <span class="token atrule">@IBOutlet</span> <span class="token keyword">weak</span> <span class="token keyword">var</span> companyField<span class="token punctuation">:</span> <span class="token builtin">UITextField</span><span class="token operator">!</span><br>    <span class="token atrule">@IBOutlet</span> <span class="token keyword">weak</span> <span class="token keyword">var</span> isCurrentEmployerSwitch<span class="token punctuation">:</span> <span class="token builtin">UISwitch</span><span class="token operator">!</span><br>    <span class="token atrule">@IBOutlet</span> <span class="token keyword">weak</span> <span class="token keyword">var</span> yearsOfExperienceStepper<span class="token punctuation">:</span> <span class="token builtin">UIStepper</span><span class="token operator">!</span><br>    <span class="token atrule">@IBOutlet</span> <span class="token keyword">weak</span> <span class="token keyword">var</span> salaryRangeSlider<span class="token punctuation">:</span> <span class="token builtin">UISlider</span><span class="token operator">!</span><br>    <span class="token atrule">@IBOutlet</span> <span class="token keyword">weak</span> <span class="token keyword">var</span> selectedSalaryRangeLabel<span class="token punctuation">:</span> <span class="token builtin">UILabel</span><span class="token operator">!</span><br>    <span class="token atrule">@IBOutlet</span> <span class="token keyword">weak</span> <span class="token keyword">var</span> selectedYearsOfExperienceLabel<span class="token punctuation">:</span> <span class="token builtin">UILabel</span><span class="token operator">!</span><br>    <br>    <span class="token keyword">var</span> viewModel<span class="token punctuation">:</span> <span class="token builtin">FormViewModel</span><span class="token operator">!</span><br>    <br>    <span class="token keyword">override</span> <span class="token keyword">func</span> <span class="token function">viewWillAppear</span><span class="token punctuation">(</span><span class="token number">_</span> animated<span class="token punctuation">:</span> <span class="token builtin">Bool</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">viewWillAppear</span><span class="token punctuation">(</span>animated<span class="token punctuation">)</span><br>        <span class="token keyword">self</span><span class="token punctuation">.</span>navigationItem<span class="token punctuation">.</span>title <span class="token operator">=</span> <span class="token string">"Survey Form"</span><br>        <span class="token function">setupBindings</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br>    <br>    <span class="token keyword">func</span> <span class="token function">setupBindings</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        nameField<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> viewModel<span class="token punctuation">.</span>name<span class="token punctuation">)</span><br>        companyField<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> viewModel<span class="token punctuation">.</span>companyName<span class="token punctuation">)</span><br>        isCurrentEmployerSwitch<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> viewModel<span class="token punctuation">.</span>isCurrentEmployer<span class="token punctuation">)</span><br>        yearsOfExperienceStepper<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> viewModel<span class="token punctuation">.</span>yearsOfExperience<span class="token punctuation">)</span><br>        salaryRangeSlider<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>with<span class="token punctuation">:</span> viewModel<span class="token punctuation">.</span>approxSalary<span class="token punctuation">)</span><br>      <br>        selectedSalaryRangeLabel<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> viewModel<span class="token punctuation">.</span>approxSalary<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token punctuation">[</span><span class="token keyword">unowned</span> <span class="token keyword">self</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">)</span> <span class="token keyword">in</span><br>            <span class="token keyword">self</span><span class="token punctuation">.</span>selectedSalaryRangeLabel<span class="token punctuation">.</span>text <span class="token operator">=</span><br>                <span class="token keyword">self</span><span class="token punctuation">.</span>viewModel<span class="token punctuation">.</span><span class="token function">getSalaryString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>        <br>        selectedYearsOfExperienceLabel<span class="token punctuation">.</span><span class="token function">observe</span><span class="token punctuation">(</span><span class="token keyword">for</span><span class="token punctuation">:</span> viewModel<span class="token punctuation">.</span>yearsOfExperience<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>            <span class="token punctuation">[</span><span class="token keyword">unowned</span> <span class="token keyword">self</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">_</span><span class="token punctuation">)</span> <span class="token keyword">in</span><br>            <span class="token keyword">self</span><span class="token punctuation">.</span>selectedYearsOfExperienceLabel<span class="token punctuation">.</span>text <span class="token operator">=</span><br>                <span class="token keyword">self</span><span class="token punctuation">.</span>viewModel<span class="token punctuation">.</span><span class="token function">getExperienceString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>setupBindings , on viewWillAppear binds our control to respective view model properties and now on all the changes are bi directional.</p>
<p>here is the code in action</p>
<div style='position:relative; padding-bottom:calc(70% + 20px)'><iframe src='https://gfycat.com/ifr/MealyThirdItaliangreyhound' frameborder='0' scrolling='no' width='100%' height='100%' style='position:absolute;top:0;left:0;background: white;' allowfullscreen></iframe></div><p> <a href="https://gfycat.com/mealythirditaliangreyhound">via Gfycat</a></p>
<p>That’s it!<br>
The entire project is available at: <a href="https://github.com/manishkkatoch/SimpleTwoWayBindingIOS">https://github.com/manishkkatoch/SimpleTwoWayBindingIOS</a></p>

  </p>
  <hr><div class="publications">
    <p>This story was also published in:</p>
      <ul>
        
        <li class="p-0"><a target="_blank" href="https://codeburst.io/swift-mvvm-two-way-binding-win-b447edc55ff5" >codeburst.io</a></li>
        
      </ul>
  </div><ul class="post-nav">
      <li class="next">
        <a href="/tech/headless-visual-testing-for-web-applications/">Headless Visual Testing For Web Applications</a>
        <i class="fas fa-chevron-right tinted"></i>
      </li>
    
  </ul>
</section>
       </div>
      </div>
  </section>
    <section class="container-fluid p-0">
      
    </section>
    
    <section class="container-fluid dark-bg align-items-center mk-footer">
        <div class="row d-flex align-items-center p-0 mx-auto">
            <div class="col-lg-3 padded-col">
                <img class="hero d-block mx-auto" src="/images/about_me.jpg" />
            </div>
            <div class="col-lg-6 padded-col">
                <section class="bio">
                    I'm <b>Manish Katoch</b>.<br/><br/>
          I am a polyglot software developer who loves and strives to write simple, clean and testable code.<br/><br/>
          As a developer, I am partial towards Scala,
          Kotlin and everything functional. I also enjoy developing mobile applications and frameworks.<br/>
          As tech lead, I have collaborated with some of the key players in the Travel, BFSI and Consumer Electronics domain to build teams that create mission-critical, consumer enriching products/platforms.
          <br/><br/>
          previously worked with NVIDIA and ThoughtWorks, I currently work with a startup with a mission to make Industry 4.0 better.
        
                </section>
            </div>
            <div class="col-lg-1 padded-col"></div>
            <div class="col-lg-2 padded-col">
                
    
        <span>I'm reachable!</span><br/><br/>
        <ul class="list-unstyled p-10">
            
    
      
        <li><a target="_blank" href="mailTo:manish.katoch@gmail.com">
      
        <span><i class="fas fa-envelope-square"></i> Email</span>
    
      </a></li>
    
    
      
        <li><a target="_blank" href="https://www.linkedin.com/in/manishkkatoch/">
      
        <span><i class="fab fa-linkedin"></i> LinkedIn</span>
    
      </a></li>
    
    
      
        <li><a target="_blank" href="https://twitter.com/m_the_katoch">
      
        <span><i class="fab fa-twitter-square"></i> Twitter</span>
    
      </a></li>
    
    
      
        <li><a target="_blank" href="https://medium.com/@manish.katoch">
      
        <span><i class="fab fa-medium"></i> Medium</span>
    
      </a></li>
    
    
    
        </ul>
        <br/>
        <span>currently in:<span><br/>
        <span>Berlin, Germany</span>
    
    
            </div>
        </div>
        <div class="row d-flex align-items-center p-40 mx-auto copy">
            <p>&copy; Manish Katoch 2020</p>
        </div>
    </section>
  

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
  </body>
</html>