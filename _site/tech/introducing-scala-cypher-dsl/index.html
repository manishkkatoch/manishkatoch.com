<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Introducing Scala Cypher DSL</title>
    <meta name="description" content="Introducing a framework which allows writing type safe complex Neo4J Cypher queries in Scala.">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/prism.base16.monokai.dark.css">
    
      <link rel="stylesheet" href="/css/home.css">
    
      <link rel="stylesheet" href="/css/footer.css">
    
      <link rel="stylesheet" href="/css/post.css">
    
    <link rel="alternate" href="." type="application/atom+xml" title="">
    <link rel="alternate" href="." type="application/json" title="">
    <script src="https://kit.fontawesome.com/0a5d5a6a83.js" crossorigin="anonymous"></script>
  </head>
  <body>
  <section class="container-fluid align-items-center">
       <div class="row dark-bg">
         <nav class="navbar navbar-expand-lg">
    <span class="navbar-brand">
        <img class="hero" src="/images/about_me.jpg" />
    </span>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
      <ul class="navbar-nav">
      
        <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="/tech/">Tech</a></li>
        <li class="nav-item"><a class="nav-link" href="/leadership/">Leadership</a></li>
        <li class="nav-item"><a class="nav-link" href="/playbooks/">Play Books</a></li>
      </ul>
    </div>
  </nav>
      </div>
      <div class="row main-row">
      <div class="col-lg-12">
       
<section class="container-fluid align-items-center post" >
  <img src="/images/cypher.jpg" class="banner"/>
  <div class="credit">
    <a target="_blank" href="https://unsplash.com/@joeljnaren">Joel Naren</a> on 
    <a target="_blank" href="https://unsplash.com">Unsplash </a>
  </div>
  <h1>Introducing Scala Cypher DSL
  </h1>

  <div class="meta">
  <p class="date">Jul 19, 2019</p>
    
        <a href="/tags/tech/" class="post-tag">#tech</a>
        <a href="/tags/scala/" class="post-tag">#scala</a>
        <a href="/tags/opensource/" class="post-tag">#opensource</a>
        <a href="/tags/neo4j/" class="post-tag">#neo4j</a>
    
  </div>
  <p>
    <blockquote>
<p>A type-safe, compile-time DSL for Neo4J Cypher Query Language in Scala</p>
</blockquote>
<p>Working with <a href="https://neo4j.com/">Neo4J</a> at <a href="https://www.thoughtworks.com/">ThoughtWorks</a>, I had a major qualm regarding the way we were interacting with the graph database using Cypher. Cypher is a declarative language, and hence, it is tricky to compose it programmatically. This is the reason why most of the ORMs (or micro-ORMs) for Neo4J are effective only for simple use-cases. We observed that, as the scale and complexity of our business logic started to increase, our code fragmented into two distinct flavours. There were Scala models and business implementations. And then there were string generation and manipulation methods to generate Cypher queries.</p>
<p>String-based queries have inherent issues like no type-safety, minimal syntax checking, difficulty in composing directly proportional to complexity, etc.</p>
<p><em><a href="https://github.com/manishkkatoch/scala-cypher-dsl">Scala-cypher-DSL</a> aims to leverage the models created as part of business logic and create Cypher queries intelligently and type-safe manner.</em></p>
<h4 id="installation">Installation <a class="direct-link" href="#installation">#</a></h4>
<p>Binary release artefacts are published to the Sonatype OSS Repository Hosting service and synced to Maven Central.</p>
<p>SBT</p>
<pre class="language-scala"><code class="language-scala"><span class="token string">"me.manishkatoch"</span> <span class="token operator">%</span><span class="token operator">%</span> <span class="token string">"scala-cypher-dsl"</span> <span class="token operator">%</span> <span class="token string">"0.4.6"</span></code></pre>
<p>Gradle</p>
<pre class="language-groovy"><code class="language-groovy">implementation group<span class="token punctuation">:</span> <span class="token string">'me.manishkatoch'</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'scala-cypher-dsl'</span><span class="token punctuation">,</span> version<span class="token punctuation">:</span> <span class="token string">'0.4.6'</span></code></pre>
<h4 id="usage">Usage <a class="direct-link" href="#usage">#</a></h4>
<p>Consider following domain models representing people working in a fictitious department and friendly by nature.</p>
<pre class="language-scala"><code class="language-scala"><span class="token comment">//sample domain models</span><br><span class="token keyword">case</span> <span class="token keyword">class</span> Person<span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> age<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><br><span class="token keyword">case</span> <span class="token keyword">class</span> WorksIn<span class="token punctuation">(</span>sinceDays<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><br><span class="token keyword">case</span> <span class="token keyword">class</span> IsFriendOf<span class="token punctuation">(</span>since<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> lastConnectedOn<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><br><span class="token keyword">case</span> <span class="token keyword">class</span> Department<span class="token punctuation">(</span>id<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">,</span> name<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span></code></pre>
<p>To start writing query DSL, import the following</p>
<pre class="language-scala"><code class="language-scala"><span class="token keyword">import</span> <span class="token namespace">me<span class="token punctuation">.</span>manishkatoch<span class="token punctuation">.</span>scala<span class="token punctuation">.</span>cypherDSL<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>syntax<span class="token punctuation">.</span>v1<span class="token punctuation">.</span></span>_<br><span class="token keyword">import</span> <span class="token namespace">me<span class="token punctuation">.</span>manishkatoch<span class="token punctuation">.</span>scala<span class="token punctuation">.</span>cypherDSL<span class="token punctuation">.</span>spec<span class="token punctuation">.</span>syntax<span class="token punctuation">.</span>patterns<span class="token punctuation">.</span></span>_ <span class="token comment">//optional, import for expressing paths.</span></code></pre>
<p>using DSL for a simple match query generation for an instance of model</p>
<pre class="language-scala"><code class="language-scala"><span class="token comment">//for a person John Doe</span><br><span class="token keyword">val</span> johnDoe <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">"AX31SD"</span><span class="token punctuation">,</span> <span class="token string">"John Doe"</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><br><br><span class="token comment">//match and return Neo4J data</span><br><span class="token keyword">val</span> johnDoeQuery <span class="token operator">=</span> cypher<span class="token punctuation">.</span>MATCH<span class="token punctuation">(</span>johnDoe<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span>RETURN<span class="token punctuation">(</span>johnDoe<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span>toQuery<span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>johnDoeQuery<span class="token punctuation">.</span>query<br><span class="token comment">//res0: String = MATCH (a0:Person {id: {a0_id},name: {a0_name},age: {a0_age}})</span><br><span class="token comment">// RETURN a0</span><br><br>johnDoeQuery<span class="token punctuation">.</span>queryMap<br><span class="token comment">//res1: scala.collection.immutable.Map[String,Any] = Map(a0_id -> AX31SD, a0_name -> John Doe, a0_age -> 50))</span></code></pre>
<p>match Person only by a property(e.g. name)</p>
<pre class="language-scala"><code class="language-scala"><span class="token comment">//for a person John Doe</span><br><span class="token keyword">val</span> johnDoe <span class="token operator">=</span> Person<span class="token punctuation">(</span><span class="token string">"AX31SD"</span><span class="token punctuation">,</span> <span class="token string">"John Doe"</span><span class="token punctuation">,</span> <span class="token number">50</span><span class="token punctuation">)</span><br><br><span class="token comment">//match and return Neo4J data</span><br><span class="token keyword">val</span> johnDoeQuery <span class="token operator">=</span> cypher<span class="token punctuation">.</span>MATCH<span class="token punctuation">(</span>johnDoe<span class="token punctuation">(</span><span class="token symbol">'name</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span>RETURN<span class="token punctuation">(</span>johnDoe<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span>toQuery<span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>johnDoeQuery<span class="token punctuation">.</span>query<br><span class="token comment">//res0: String = MATCH (a0:Person {id: {a0_id},name: {a0_name},age: {a0_age}})</span><br><span class="token comment">//              RETURN a0</span><br><br>johnDoeQuery<span class="token punctuation">.</span>queryMap<br><span class="token comment">//res1: scala.collection.immutable.Map[String,Any] = Map(a0_id -> AX31SD, a0_name -> John Doe, a0_age -> 50))</span></code></pre>
<blockquote>
<p><em>Note</em>: if the property doesn’t exist, compilation will fail. Yay!</p>
</blockquote>
<p>using DSL for matching any instance of model.</p>
<pre class="language-scala"><code class="language-scala"><span class="token comment">//for any person</span><br><span class="token keyword">val</span> anyPerson <span class="token operator">=</span> any<span class="token punctuation">[</span>Person<span class="token punctuation">]</span> <span class="token comment">// any instance of node labelled Person</span><br><br><span class="token keyword">val</span> result <span class="token operator">=</span> cypher<span class="token punctuation">.</span>MATCH<span class="token punctuation">(</span>anyPerson<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span>RETURN<span class="token punctuation">(</span>anyPerson<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span>toQuery<span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>result<span class="token punctuation">.</span>query<br><span class="token comment">//res0: String = MATCH (a0:Person)</span><br><span class="token comment">//               RETURN a0</span><br><br>result<span class="token punctuation">.</span>queryMap<br><span class="token comment">//res1: scala.collection.immutable.Map[String,Any] = Map()</span><br>query <span class="token keyword">for</span> all the friends of John Doe in Science department<br><br><span class="token keyword">val</span> scienceDept <span class="token operator">=</span> Department<span class="token punctuation">(</span><span class="token string">"ZSW12R"</span><span class="token punctuation">,</span> <span class="token string">"Science"</span><span class="token punctuation">)</span><br><span class="token keyword">val</span> anyPerson <span class="token operator">=</span> any<span class="token punctuation">[</span>Person<span class="token punctuation">]</span><br><span class="token keyword">val</span> isFriendOf <span class="token operator">=</span> anyRel<span class="token punctuation">[</span>IsFriendOf<span class="token punctuation">]</span> <span class="token comment">//any relation instance of label IsFriendOf</span><br><br><span class="token keyword">val</span> result <span class="token operator">=</span> cypher<span class="token punctuation">.</span>MATCH<span class="token punctuation">(</span>johnDoe <span class="token operator">-</span><span class="token operator">|</span> isFriendOf <span class="token operator">|</span><span class="token operator">-></span> anyPerson <span class="token keyword">&lt;-</span><span class="token operator">-</span> scienceDept<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span>RETURN<span class="token punctuation">(</span>anyPerson<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span>toQuery<span class="token punctuation">(</span><span class="token punctuation">)</span><br><br>result<span class="token punctuation">.</span>query<br><span class="token comment">//res0: String = MATCH (a0:Person {id: {a0_id},name: {a0_name},age: {a0_age}})-[a1:IS_FRIEND_OF]->(a2:Person)&lt;--(a3:Department {id: {a3_id},name: {a3_name}})</span><br><span class="token comment">//               RETURN a2</span><br><br>result<span class="token punctuation">.</span>queryMap<br><span class="token comment">//res1: scala.collection.immutable.Map[String,Any] = Map(a0_id -> AX31SD, a0_name -> John Doe, a3_name -> Science, a0_age -> 50, a3_id -> ZSW12R)</span></code></pre>
<p>for detailed DSL usage and more examples, there is a <a href="https://github.com/manishkkatoch/scala-cypher-dsl/wiki">wiki</a>.</p>
<p>Support and Contributions</p>
<p><a href="https://github.com/manishkkatoch/scala-cypher-dsl">Scala-cypher-DSL</a> aims to be an important library for anyone who wants to write idiomatic scala when interacting with Neo4J or any other cypher query language based platform.I aim to support 100% of cypher specification and any form of contribution (issue report, PR, etc) is more than welcome!</p>

  </p>
  <hr><div class="publications">
    <p>This story was also published in:</p>
      <ul>
        
        <li class="p-0"><a target="_blank" href="https://medium.com/neo4j/introducing-scala-cypher-dsl-51d28588cd51" >Neo4J Developer Blog</a></li>
        
      </ul>
  </div><ul class="post-nav">
      <li class="previous">
        <i class="fas fa-chevron-left tinted"></i>
        <a href="/tech/dependent-types-in-scala/">Dependent Types in Scala — A practical example</a>
      </li>
    
  </ul>
</section>
       </div>
      </div>
  </section>
    <section class="container-fluid p-0">
      
    </section>
    
    <section class="container-fluid dark-bg align-items-center mk-footer">
        <div class="row d-flex align-items-center p-0 mx-auto">
            <div class="col-lg-3 padded-col">
                <img class="hero d-block mx-auto" src="/images/about_me.jpg" />
            </div>
            <div class="col-lg-6 padded-col">
                <section class="bio">
                    I'm <b>Manish Katoch</b>.<br/><br/>
          I am a polyglot software developer who loves and strives to write simple, clean and testable code.<br/><br/>
          As a developer, I am partial towards Scala,
          Kotlin and everything functional. I also enjoy developing mobile applications and frameworks.<br/>
          As tech lead, I have collaborated with some of the key players in the Travel, BFSI and Consumer Electronics domain to build teams that create mission-critical, consumer enriching products/platforms.
          <br/><br/>
          previously worked with NVIDIA and ThoughtWorks, I currently work with a startup with a mission to make Industry 4.0 better.
        
                </section>
            </div>
            <div class="col-lg-1 padded-col"></div>
            <div class="col-lg-2 padded-col">
                
    
        <span>I'm reachable!</span><br/><br/>
        <ul class="list-unstyled p-10">
            
    
      
        <li><a target="_blank" href="mailTo:manish.katoch@gmail.com">
      
        <span><i class="fas fa-envelope-square"></i> Email</span>
    
      </a></li>
    
    
      
        <li><a target="_blank" href="https://www.linkedin.com/in/manishkkatoch/">
      
        <span><i class="fab fa-linkedin"></i> LinkedIn</span>
    
      </a></li>
    
    
      
        <li><a target="_blank" href="https://twitter.com/m_the_katoch">
      
        <span><i class="fab fa-twitter-square"></i> Twitter</span>
    
      </a></li>
    
    
      
        <li><a target="_blank" href="https://medium.com/@manish.katoch">
      
        <span><i class="fab fa-medium"></i> Medium</span>
    
      </a></li>
    
    
    
        </ul>
        <br/>
        <span>currently in:<span><br/>
        <span>Berlin, Germany</span>
    
    
            </div>
        </div>
        <div class="row d-flex align-items-center p-40 mx-auto copy">
            <p>&copy; Manish Katoch 2020</p>
        </div>
    </section>
  

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
  </body>
</html>