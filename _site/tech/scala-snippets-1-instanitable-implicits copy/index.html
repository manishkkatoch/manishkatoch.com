<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dependent Types in Scala — A practical example</title>
    <meta name="description" content="This is a post on My Blog about touchpoints and circling wagons.">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/prism.base16.monokai.dark.css">
    
      <link rel="stylesheet" href="/css/home.css">
    
      <link rel="stylesheet" href="/css/footer.css">
    
      <link rel="stylesheet" href="/css/post.css">
    
    <link rel="alternate" href="." type="application/atom+xml" title="">
    <link rel="alternate" href="." type="application/json" title="">
    <script src="https://kit.fontawesome.com/0a5d5a6a83.js" crossorigin="anonymous"></script>
  </head>
  <body>
  <section class="container-fluid align-items-center">
       <div class="row dark-bg main-row">
         <nav class="navbar navbar-expand-lg">
    <span class="navbar-brand">
        <img class="hero" src="/images/about_me.jpg" />
    </span>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNavDropdown">
      <ul class="navbar-nav">
      
        <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="/tech/">Tech</a></li>
      </ul>
    </div>
  </nav>
      </div>
      <div class="row main-row">
       
<section class="container-fluid align-items-center post" >
  <img src="https://source.unsplash.com/4zwozQxDbD4/1600x900" class="banner"/>
  <div class="credit">
    <a target="_blank" href="https://unsplash.com/@guiccunha">Guilherme Cunha</a> on 
    <a target="_blank" href="https://unsplash.com">Unsplash </a>
  </div>
  <h1>Dependent Types in Scala — A practical example
  </h1>

  <div class="meta">
  <p class="date">Sep 09, 2018</p>
    
        <a href="/tags/tech/" class="post-tag">#tech</a>
        <a href="/tags/scala/" class="post-tag">#scala</a>
        <a href="/tags/patterns/" class="post-tag">#patterns</a>
    
  </div>
  <p>
    <p>If you have ever written non-trivial code in Scala, you would have come across methods that take implicit parameters. Implicitly passing parameter is an important aspect of Scala that provides a <strong>contextual abstraction</strong> to your domain. One can design the domain model by the fact that by the time of instantiation and processing the functionality of the implicitly passed parameter will be available, irrespective of how it is created or provided. Implicit parameters are defined by prefixing <code>implicit</code> keyword to the parameter of a method. all the parameters defined after the keyword are implicit to the method definition.</p>
<p>When Scala encounters such method on compile time and provided the parameter is not passed explicitly, it tries to find an implicit definition in the lexical scope of the call chain and if it can, passes it automatically.</p>
<p>There are three ways to define an implicit parameter instance:</p>
<ul>
<li>a val or var defined with implicit keyword in the lexical scope.</li>
<li>importing above defined instance from other modules into the scope.</li>
<li>defining the type in such a way that it can be created if no instance found.</li>
</ul>
<p>First two being trivial methods, below is a useful pattern to define the type that can provide an implicit instance if none found in scope.</p>
<pre class="language-scala"><code class="language-scala"><br><span class="token comment">// The trait that needs to be implicitly passed.</span><br><span class="token keyword">trait</span> StringConverter<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token punctuation">{</span> <br> <span class="token keyword">def</span> getStringRepresentation<span class="token punctuation">(</span>t<span class="token operator">:</span> T<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">String</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// companion object to provide apply and implicit definitions per type.</span><br><span class="token keyword">object</span> StringConverter <span class="token punctuation">{</span><br><br>    <span class="token comment">// apply method to be called by compiler in case no instance found.</span><br>    <span class="token keyword">def</span> apply<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">implicit</span> stringConverter<span class="token operator">:</span> StringConverter<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> StringConverter<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token operator">=</span> stringConverter<br><br>    <span class="token comment">// sugar method to avoid writing the new construct for each instance. </span><br>    <span class="token keyword">def</span> createConverter<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">(</span>f<span class="token operator">:</span> T <span class="token keyword">=></span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> StringConverter<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> StringConverter<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token punctuation">{</span> <br>        <span class="token keyword">override</span> <span class="token keyword">def</span> getStringRepresentation<span class="token punctuation">(</span>t<span class="token operator">:</span> T<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> f<span class="token punctuation">(</span>t<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token comment">// basic implicit instances for primitive types.</span><br>    <span class="token keyword">implicit</span> <span class="token keyword">val</span> intConverter<span class="token operator">:</span> StringConverter<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> createConverter<span class="token punctuation">(</span>t <span class="token keyword">=></span> s<span class="token string">"Int: $t"</span><span class="token punctuation">)</span><br>    <span class="token keyword">implicit</span> <span class="token keyword">val</span> doubleConverter<span class="token operator">:</span> StringConverter<span class="token punctuation">[</span><span class="token builtin">Double</span><span class="token punctuation">]</span> <span class="token operator">=</span> createConverter<span class="token punctuation">(</span>t <span class="token keyword">=></span> f<span class="token string">"Double: $t%2.2f"</span><span class="token punctuation">)</span><br>    <span class="token keyword">implicit</span> <span class="token keyword">val</span> longConverter<span class="token operator">:</span> StringConverter<span class="token punctuation">[</span><span class="token builtin">Long</span><span class="token punctuation">]</span> <span class="token operator">=</span> createConverter<span class="token punctuation">(</span>t <span class="token keyword">=></span> s<span class="token string">"Long: $t"</span><span class="token punctuation">)</span><br>    <span class="token keyword">implicit</span> <span class="token keyword">val</span> booleanConverter<span class="token operator">:</span> StringConverter<span class="token punctuation">[</span><span class="token builtin">Boolean</span><span class="token punctuation">]</span> <span class="token operator">=</span> createConverter <span class="token punctuation">{</span> <br>        <span class="token keyword">case</span> <span class="token boolean">true</span> <span class="token keyword">=></span> <span class="token string">"YES"</span><br>        <span class="token keyword">case</span> <span class="token boolean">false</span> <span class="token keyword">=></span> <span class="token string">"NO"</span> <br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">implicit</span> <span class="token keyword">val</span> stringConverter<span class="token operator">:</span>StringConverter<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span><br>        createConverter<span class="token punctuation">(</span>t <span class="token keyword">=></span> t<span class="token punctuation">.</span>toLowerCase<span class="token punctuation">)</span> <br><br>    <span class="token comment">// A generic converter for type T provided at compile time.</span><br>    <span class="token keyword">implicit</span> <span class="token keyword">def</span> productConverter<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token operator">:</span> StringConverter<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token operator">=</span><br>        createConverter<span class="token punctuation">(</span>instance <span class="token keyword">=></span> instance<span class="token punctuation">.</span>toString<span class="token punctuation">)</span> <br><span class="token punctuation">}</span><br></code></pre>
<p>The essence of the pattern is to define <code>apply</code> method which provides the implicit instance to the caller. Such implicit parameter can be used in two ways: as implicit parameter explained above and as a context bound to type parameter.</p>
<blockquote>
<p>The context bound usage is specially useful if the implicit parameter needs to be used downstream as you can eliminate defining the implicit parameter in all the subsequent methods.</p>
</blockquote>
<pre class="language-scala"><code class="language-scala"><br><span class="token comment">// defining an implicit converter</span><br><span class="token keyword">def</span> toRepr<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">(</span>t<span class="token operator">:</span> T<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">implicit</span> stringConverter<span class="token operator">:</span> StringConverter<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <br>    stringConverter<span class="token punctuation">.</span>getStringRepresentation<span class="token punctuation">(</span>t<span class="token punctuation">)</span><br><br><span class="token comment">// defining context bound implicit, ideal when the implicit needs to be passed down the call chain. </span><br><span class="token comment">// works identical to implicit parameter and is an aesthetic choice.</span><br><span class="token keyword">def</span> contextBoundToRepr<span class="token punctuation">[</span>T<span class="token operator">:</span> StringConverter<span class="token punctuation">]</span><span class="token punctuation">(</span>t<span class="token operator">:</span> T<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <br>    implicitly<span class="token punctuation">[</span>StringConverter<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>getStringRepresentation<span class="token punctuation">(</span>t<span class="token punctuation">)</span><br></code></pre>
<p>and can be used as below:</p>
<pre class="language-scala"><code class="language-scala"><br><span class="token keyword">import</span> StringConverter<span class="token punctuation">.</span>_toRepr<span class="token punctuation">(</span><span class="token number">12000</span><span class="token punctuation">)</span><br><span class="token comment">//res0: String = Int: 12000</span><br><br>toRepr<span class="token punctuation">[</span><span class="token builtin">Double</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">120.1234</span><span class="token punctuation">)</span><br><span class="token comment">//res1: String = Double: 120.12</span><br><br>toRepr<span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><br><span class="token comment">//res2: String = NO</span><br><br>contextBoundToRepr<span class="token punctuation">(</span><span class="token string">"SomeThingSmallCased"</span><span class="token punctuation">)</span><br><span class="token comment">//res3: String = somethingsmallcased</span><br><br>contextBoundToRepr<span class="token punctuation">(</span>Set<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token comment">//res4: String = Set(1, 2, 3, 4)</span><br></code></pre>
<p>Every time Scala doesn’t find an implicit value, it will create a new instance at compile time. <strong>this can considerably increase the compile time</strong> as well as the compiled library size for a fairly large project with traits, working on large number domain models, provided implicitly. Consider below code where we haven’t provided any default <code>StringConverter</code> and we have two separate scope which expects a <code>StringConverter[T]</code></p>
<pre class="language-scala"><code class="language-scala"><span class="token keyword">object</span> StringConverter <span class="token punctuation">{</span> <br>    <span class="token comment">// apply method to be called by compiler in case no instance found. </span><br>    <span class="token keyword">def</span> apply<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">implicit</span> stringConverter<span class="token operator">:</span> StringConverter<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> StringConverter<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token operator">=</span> stringConverter<br>    <br>    <span class="token comment">// sugar method to avoid writing the new construct for each instance.</span><br>    <span class="token keyword">def</span> createConverter<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">(</span>f<span class="token operator">:</span> T <span class="token keyword">=></span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> StringConverter<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> StringConverter<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token punctuation">{</span> <br>        <span class="token keyword">override</span> <span class="token keyword">def</span> getStringRepresentation<span class="token punctuation">(</span>t<span class="token operator">:</span> T<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> f<span class="token punctuation">(</span>t<span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><br><br>    <span class="token keyword">implicit</span> <span class="token keyword">def</span> productConverter<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token operator">:</span> StringConverter<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token operator">=</span><br>        createConverter<span class="token punctuation">(</span>instance <span class="token keyword">=></span> instance<span class="token punctuation">.</span>toString<span class="token punctuation">)</span> <br><span class="token punctuation">}</span><br><br><span class="token comment">// caller method</span><br><span class="token keyword">def</span> implicitTestMethod<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">(</span>t<span class="token operator">:</span> T<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">implicit</span> stringConverter<span class="token operator">:</span> StringConverter<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <br>    println<span class="token punctuation">(</span>s<span class="token string">"instance: ${stringConverter.hashCode()}"</span><span class="token punctuation">)</span> <br>    stringConverter<span class="token punctuation">.</span>getStringRepresentation<span class="token punctuation">(</span>t<span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token comment">// methods to simulate different scopes </span><br><span class="token keyword">def</span> enclosingScopeA<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token builtin">String</span> <span class="token operator">=</span> implicitTestMethod<span class="token punctuation">(</span><span class="token string">"SomeThing"</span><span class="token punctuation">)</span><br><span class="token keyword">def</span> enclosingScopeB<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> implicitTestMethod<span class="token punctuation">(</span><span class="token string">"SomeThing"</span><span class="token punctuation">)</span><br><br><span class="token comment">// on Run</span><br>enclosingScopeA<span class="token punctuation">(</span><span class="token punctuation">)</span> <br><span class="token comment">//instance: 1930418516 //res0: String = something</span><br><br>enclosingScopeB<span class="token punctuation">(</span><span class="token punctuation">)</span> <br><span class="token comment">//instance: 323825454 //res1: String = something</span></code></pre>
<p>If we see the instances of StringConverter used they are different. Now imagine this happening across a large project. In such cases, one should always create an <strong>implicit’s cache</strong> and use it to ensure the implicits are created only once like below:</p>
<pre class="language-scala"><code class="language-scala"><span class="token keyword">object</span> ImplicitCache <span class="token punctuation">{</span> <br>    <span class="token keyword">implicit</span> <span class="token keyword">val</span> stringConverter <span class="token operator">=</span> StringConverter<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <br><span class="token punctuation">}</span><br><br><span class="token keyword">def</span> enclosingScopeA<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span><span class="token builtin">String</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <br>    <span class="token keyword">import</span> ImplicitCache<span class="token punctuation">.</span>_<br>    implicitTestMethod<span class="token punctuation">(</span><span class="token string">"SomeThing"</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">def</span> enclosingScopeB<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">String</span> <span class="token operator">=</span> <span class="token punctuation">{</span><br>    <span class="token keyword">import</span> ImplicitCache<span class="token punctuation">.</span>_<br>    implicitTestMethod<span class="token punctuation">(</span><span class="token string">"SomeThing"</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre>
<p>When run, uses the same instance throughout:</p>
<pre class="language-scala"><code class="language-scala"><span class="token comment">// on Run</span><br>enclosingScopeA<span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token comment">//instance: 1281624893 //res0: String = something  </span><br><br>enclosingScopeB<span class="token punctuation">(</span><span class="token punctuation">)</span><br><span class="token comment">//instance: 1281624893 //res1: String = something</span></code></pre>
<p>That’s it!</p>
<p>I hope this helps understanding implicits better and aids in using them elegantly, utilizing all the awesomeness it provides.</p>

  </p>
  <hr>
  <ul class="post-nav">
      <li class="next">
        <a href="/tech/scala-snippets-1-instanitable-implicits/">Instantiable Implicits in Scala</a>
        <i class="fas fa-chevron-right tinted"></i>
      </li>
    
  </ul>
</section>
      </div>
  </section>
    <section class="container-fluid p-0">
      
    </section>
    
    <section class="container-fluid dark-bg align-items-center mk-footer">
        <div class="row d-flex align-items-center p-0 mx-auto">
            <div class="col-lg-3 padded-col">
                <img class="hero d-block mx-auto" src="/images/about_me.jpg" />
            </div>
            <div class="col-lg-6 padded-col">
                <section class="bio">
                    I'm <b>Manish Katoch</b>.<br/><br/>
          I am a polyglot software developer who loves and strives to write simple, clean and testable code.<br/><br/>
          As a developer, I am partial towards Scala,
          Kotlin and everything functional. I also enjoy developing mobile applications and frameworks.<br/>
          As tech lead, I have collaborated with some of the key players in the Travel, BFSI and Consumer Electronics domain to build teams that create mission-critical, consumer enriching products/platforms.
          <br/><br/>
          previously worked with NVIDIA and ThoughtWorks, I currently work with a startup with a mission to make Industry 4.0 better.
        
                </section>
            </div>
            <div class="col-lg-1 padded-col"></div>
            <div class="col-lg-2 padded-col">
                
    
        <span>I'm reachable!</span><br/><br/>
        <ul class="list-unstyled p-10">
            
    
      
        <li><a target="_blank" href="mailTo:manish.katoch@gmail.com">
      
        <span><i class="fas fa-envelope-square"></i> Email</span>
    
      </a></li>
    
    
      
        <li><a target="_blank" href="https://www.linkedin.com/in/manishkkatoch/">
      
        <span><i class="fab fa-linkedin"></i> LinkedIn</span>
    
      </a></li>
    
    
      
        <li><a target="_blank" href="https://twitter.com/m_the_katoch">
      
        <span><i class="fab fa-twitter-square"></i> Twitter</span>
    
      </a></li>
    
    
      
        <li><a target="_blank" href="https://medium.com/@manish.katoch">
      
        <span><i class="fab fa-medium"></i> Medium</span>
    
      </a></li>
    
    
    
        </ul>
        <br/>
        <span>currently in:<span><br/>
        <span>Berlin, Germany</span>
    
    
            </div>
        </div>
        <div class="row d-flex align-items-center p-40 mx-auto copy">
            <p>&copy; Manish Katoch 2020</p>
        </div>
    </section>
  
  </body>
</html>